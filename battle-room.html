<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Racing Arena - Tez Roq Yoz</title>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-primary: #0a0a0a;
      --bg-secondary: #1a1a1a;
      --bg-tertiary: #2a2a2a;
      --text-primary: #ffffff;
      --text-secondary: #888888;
      --accent: #00ff88;
      --accent-secondary: #ff6b35;
      --success: #4ade80;
      --error: #ef4444;
      --battle: #ff3366;
      --gold: #ffd700;
      --silver: #c0c0c0;
      --bronze: #cd7f32;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html, body {
      height: 100vh;
      font-family: 'JetBrains Mono', monospace;
      background: linear-gradient(135deg, var(--bg-primary) 0%, #1a1a2e 50%, var(--bg-primary) 100%);
      color: var(--text-primary);
      overflow: hidden;
    }

    /* Animated Background */
    .bg-animation {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
      opacity: 0.1;
    }

    .bg-animation::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: 
        radial-gradient(circle at 20% 50%, var(--accent) 0%, transparent 50%),
        radial-gradient(circle at 80% 20%, var(--accent-secondary) 0%, transparent 50%),
        radial-gradient(circle at 40% 80%, var(--battle) 0%, transparent 50%);
      animation: bgMove 20s ease-in-out infinite;
    }

    @keyframes bgMove {
      0%, 100% { transform: translateX(0) translateY(0); }
      33% { transform: translateX(-20px) translateY(-20px); }
      66% { transform: translateX(20px) translateY(-10px); }
    }

    /* Victory Screen */
    .victory-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: linear-gradient(135deg, rgba(10, 10, 10, 0.95) 0%, rgba(26, 26, 46, 0.95) 50%, rgba(10, 10, 10, 0.95) 100%);
      backdrop-filter: blur(20px);
      z-index: 9999;
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      animation: victoryFadeIn 1s ease-in-out;
    }

    @keyframes victoryFadeIn {
      from { opacity: 0; transform: scale(0.8); }
      to { opacity: 1; transform: scale(1); }
    }

    .victory-crown {
      font-size: 10rem;
      margin-bottom: 40px;
      animation: crownBounce 2s infinite;
      filter: drop-shadow(0 0 30px var(--gold));
    }

    @keyframes crownBounce {
      0%, 100% { transform: translateY(0) rotate(0deg); }
      25% { transform: translateY(-30px) rotate(-10deg); }
      75% { transform: translateY(-15px) rotate(10deg); }
    }

    .victory-title {
      font-size: 5rem;
      font-weight: 700;
      background: linear-gradient(45deg, var(--gold), var(--accent), var(--gold));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-bottom: 30px;
      text-transform: uppercase;
      letter-spacing: 3px;
      animation: titleGlow 2s ease-in-out infinite alternate;
    }

    @keyframes titleGlow {
      from { filter: drop-shadow(0 0 20px var(--gold)); }
      to { filter: drop-shadow(0 0 40px var(--accent)); }
    }

    .winner-name {
      font-size: 3.5rem;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 40px;
      text-shadow: 0 0 30px rgba(255, 255, 255, 0.8);
      animation: nameShine 3s ease-in-out infinite;
    }

    @keyframes nameShine {
      0%, 100% { color: var(--text-primary); }
      50% { color: var(--accent); }
    }

    .victory-stats {
      display: flex;
      gap: 50px;
      margin-bottom: 50px;
      font-size: 1.3rem;
    }

    .victory-stat {
      background: linear-gradient(135deg, rgba(0, 255, 136, 0.1), rgba(255, 107, 53, 0.1));
      border: 3px solid var(--accent);
      border-radius: 20px;
      padding: 25px 35px;
      text-align: center;
      animation: statPulse 2s ease-in-out infinite;
      backdrop-filter: blur(10px);
    }

    @keyframes statPulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }

    .victory-stat-value {
      font-size: 2.5rem;
      font-weight: 700;
      color: var(--accent);
      display: block;
      margin-bottom: 5px;
    }

    .victory-stat-label {
      color: var(--text-secondary);
      font-size: 1rem;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .victory-buttons {
      display: flex;
      gap: 30px;
      margin-top: 40px;
    }

    .victory-btn {
      padding: 20px 40px;
      border: none;
      border-radius: 15px;
      font-size: 1.2rem;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s;
      font-family: 'JetBrains Mono', monospace;
      display: flex;
      align-items: center;
      gap: 15px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .victory-btn-primary {
      background: linear-gradient(45deg, var(--accent), var(--accent-secondary));
      color: var(--bg-primary);
    }

    .victory-btn-primary:hover {
      transform: translateY(-3px);
      box-shadow: 0 15px 35px rgba(0, 255, 136, 0.4);
    }

    .victory-btn-secondary {
      background: linear-gradient(45deg, var(--bg-secondary), var(--bg-tertiary));
      color: var(--text-primary);
      border: 2px solid var(--bg-tertiary);
    }

    .victory-btn-secondary:hover {
      background: linear-gradient(45deg, var(--bg-tertiary), var(--bg-secondary));
      border-color: var(--accent);
      transform: translateY(-3px);
    }

    /* Mobile Block */
    .mobile-block {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: var(--bg-primary);
      z-index: 9999;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: 40px 20px;
    }

    .mobile-block-icon {
      font-size: 5rem;
      margin-bottom: 30px;
      opacity: 0.8;
      animation: bounce 2s infinite;
    }

    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-20px); }
    }

    .mobile-block-title {
      font-size: 2rem;
      font-weight: 700;
      color: var(--accent);
      margin-bottom: 20px;
      line-height: 1.2;
    }

    .mobile-block-message {
      font-size: 1.2rem;
      color: var(--text-secondary);
      line-height: 1.5;
      max-width: 400px;
    }

    /* Main Layout */
    .battle-layout {
      height: 100vh;
      display: flex;
      flex-direction: column;
      position: relative;
    }

    /* Header */
    .header {
      height: 80px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 40px;
      background: rgba(26, 26, 26, 0.9);
      backdrop-filter: blur(20px);
      border-bottom: 2px solid var(--accent);
      position: relative;
      overflow: hidden;
    }

    .header::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(0, 255, 136, 0.1), transparent);
      animation: headerScan 3s linear infinite;
    }

    @keyframes headerScan {
      0% { left: -100%; }
      100% { left: 100%; }
    }

    .room-info {
      display: flex;
      align-items: center;
      gap: 25px;
      z-index: 1;
    }

    .room-code {
      background: linear-gradient(135deg, rgba(0, 255, 136, 0.1), rgba(255, 107, 53, 0.1));
      border: 2px solid var(--accent);
      border-radius: 12px;
      padding: 12px 20px;
      color: var(--accent);
      font-weight: 700;
      font-size: 1.2rem;
      letter-spacing: 3px;
      text-transform: uppercase;
    }

    .room-status {
      display: flex;
      align-items: center;
      gap: 12px;
      color: var(--text-secondary);
      font-size: 1rem;
    }

    .status-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: var(--success);
      animation: pulse 2s infinite;
      box-shadow: 0 0 10px var(--success);
    }

    .status-dot.waiting {
      background: var(--accent);
      box-shadow: 0 0 10px var(--accent);
    }

    .status-dot.racing {
      background: var(--battle);
      box-shadow: 0 0 10px var(--battle);
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.7; transform: scale(1.2); }
    }

    .header-actions {
      display: flex;
      align-items: center;
      gap: 20px;
      z-index: 1;
    }

    .btn {
      padding: 12px 20px;
      border: none;
      border-radius: 10px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      font-family: 'JetBrains Mono', monospace;
      display: flex;
      align-items: center;
      gap: 8px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .btn-secondary {
      background: linear-gradient(45deg, var(--bg-secondary), var(--bg-tertiary));
      color: var(--text-primary);
      border: 2px solid var(--bg-tertiary);
    }

    .btn-secondary:hover {
      background: linear-gradient(45deg, var(--accent), var(--accent-secondary));
      color: var(--bg-primary);
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(0, 255, 136, 0.3);
    }

    .btn-battle {
      background: linear-gradient(45deg, var(--battle), var(--accent-secondary));
      color: white;
    }

    .btn-battle:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(255, 51, 102, 0.4);
    }

    /* Main Content */
    .main-content {
      flex: 1;
      display: flex;
      gap: 40px;
      padding: 40px;
    }

    /* Players Panel */
    .players-panel {
      width: 350px;
      background: linear-gradient(135deg, rgba(26, 26, 26, 0.9), rgba(42, 42, 42, 0.9));
      border: 2px solid var(--accent);
      border-radius: 20px;
      padding: 30px;
      backdrop-filter: blur(10px);
      position: relative;
      overflow: hidden;
    }

    .players-panel::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, var(--accent), var(--accent-secondary), var(--battle));
      animation: progressMove 2s linear infinite;
    }

    @keyframes progressMove {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }

    .players-title {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 25px;
      display: flex;
      align-items: center;
      gap: 12px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .player-card {
      background: linear-gradient(135deg, rgba(10, 10, 10, 0.8), rgba(26, 26, 26, 0.8));
      border: 2px solid var(--bg-tertiary);
      border-radius: 15px;
      padding: 20px;
      margin-bottom: 20px;
      position: relative;
      transition: all 0.3s;
      overflow: hidden;
    }

    .player-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.05), transparent);
      transition: left 0.6s ease;
    }

    .player-card:hover::before {
      left: 100%;
    }

    .player-card.ready {
      border-color: var(--success);
      box-shadow: 0 0 20px rgba(74, 222, 128, 0.2);
    }

    .player-card.host {
      border-color: var(--gold);
      box-shadow: 0 0 20px rgba(255, 215, 0, 0.2);
    }

    .player-card.racing {
      border-color: var(--battle);
      box-shadow: 0 0 20px rgba(255, 51, 102, 0.2);
    }

    .player-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 15px;
    }

    .player-name {
      font-weight: 700;
      color: var(--text-primary);
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 1.1rem;
    }

    .player-position {
      font-size: 1.5rem;
      margin-right: 8px;
    }

    .player-badge {
      font-size: 0.8rem;
      padding: 4px 10px;
      border-radius: 15px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .badge-host {
      background: linear-gradient(45deg, var(--gold), #ffed4e);
      color: var(--bg-primary);
    }

    .badge-ready {
      background: linear-gradient(45deg, var(--success), #22c55e);
      color: white;
    }

    .badge-waiting {
      background: var(--text-secondary);
      color: white;
    }

    .badge-racing {
      background: linear-gradient(45deg, var(--battle), var(--accent-secondary));
      color: white;
    }

    .player-stats {
      display: flex;
      justify-content: space-between;
      font-size: 0.95rem;
      color: var(--text-secondary);
      margin-bottom: 15px;
    }

    .player-progress {
      width: 100%;
      height: 8px;
      background: var(--bg-tertiary);
      border-radius: 4px;
      overflow: hidden;
      position: relative;
    }

    .progress-bar {
      height: 100%;
      background: linear-gradient(90deg, var(--accent), var(--accent-secondary));
      border-radius: 4px;
      transition: width 0.3s ease;
      width: 0%;
      position: relative;
    }

    .progress-bar::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
      animation: progressShine 2s linear infinite;
    }

    @keyframes progressShine {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }

    /* Game Area */
    .game-area {
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    .game-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 40px;
    }

    .game-timer {
      font-size: 4rem;
      font-weight: 700;
      background: linear-gradient(45deg, var(--accent), var(--accent-secondary));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      text-shadow: 0 0 30px rgba(0, 255, 136, 0.5);
      animation: timerPulse 1s ease-in-out infinite alternate;
    }

    @keyframes timerPulse {
      from { transform: scale(1); }
      to { transform: scale(1.05); }
    }

    .game-stats {
      display: flex;
      gap: 40px;
    }

    .stat-item {
      text-align: center;
      background: linear-gradient(135deg, rgba(0, 255, 136, 0.1), rgba(255, 107, 53, 0.1));
      border: 2px solid var(--accent);
      border-radius: 15px;
      padding: 20px;
      backdrop-filter: blur(10px);
    }

    .stat-value {
      font-size: 2.5rem;
      font-weight: 700;
      color: var(--text-primary);
      display: block;
      margin-bottom: 5px;
    }

    .stat-label {
      color: var(--text-secondary);
      font-size: 0.9rem;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    /* Text Display */
    .text-display {
      background: linear-gradient(135deg, rgba(26, 26, 26, 0.9), rgba(42, 42, 42, 0.9));
      border: 2px solid var(--accent);
      border-radius: 20px;
      padding: 50px;
      margin-bottom: 40px;
      min-height: 250px;
      display: flex;
      align-items: center;
      justify-content: center;
      backdrop-filter: blur(10px);
      position: relative;
      overflow: hidden;
    }

    .text-display::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, var(--accent), var(--accent-secondary), var(--battle));
      animation: progressMove 2s linear infinite;
    }

    .text-content {
      font-size: 1.6rem;
      line-height: 2.2;
      text-align: center;
      max-width: 900px;
      position: relative;
    }

    .char {
      position: relative;
      transition: all 0.1s;
      padding: 2px;
      border-radius: 3px;
    }

    .char.correct {
      color: var(--success);
      background: rgba(74, 222, 128, 0.15);
      box-shadow: 0 0 5px rgba(74, 222, 128, 0.3);
    }

    .char.incorrect {
      color: var(--error);
      background: rgba(239, 68, 68, 0.2);
      box-shadow: 0 0 5px rgba(239, 68, 68, 0.3);
    }

    .char.current {
      background: var(--accent);
      color: var(--bg-primary);
      animation: blink 1s infinite;
      box-shadow: 0 0 15px var(--accent);
    }

    @keyframes blink {
      0%, 50% { opacity: 1; }
      51%, 100% { opacity: 0.3; }
    }

    /* Input Area */
    .input-area {
      background: linear-gradient(135deg, rgba(26, 26, 26, 0.9), rgba(42, 42, 42, 0.9));
      border: 2px solid var(--accent);
      border-radius: 20px;
      padding: 40px;
      text-align: center;
      backdrop-filter: blur(10px);
      position: relative;
      overflow: hidden;
    }

    .input-area::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, var(--accent), var(--accent-secondary), var(--battle));
      animation: progressMove 2s linear infinite;
    }

    .typing-input {
      width: 100%;
      background: rgba(10, 10, 10, 0.8);
      border: 3px solid var(--bg-tertiary);
      border-radius: 15px;
      padding: 25px;
      font-size: 1.4rem;
      color: var(--text-primary);
      font-family: 'JetBrains Mono', monospace;
      outline: none;
      transition: all 0.3s;
      text-align: center;
    }

    .typing-input:focus {
      border-color: var(--accent);
      box-shadow: 0 0 30px rgba(0, 255, 136, 0.3);
    }

    .typing-input:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .input-hint {
      margin-top: 20px;
      color: var(--text-secondary);
      font-size: 1rem;
      font-weight: 500;
    }

    /* Ready Button */
    .ready-section {
      text-align: center;
      margin-top: 40px;
    }

    .ready-btn {
      padding: 20px 50px;
      font-size: 1.3rem;
      font-weight: 700;
      border: none;
      border-radius: 15px;
      cursor: pointer;
      transition: all 0.3s;
      font-family: 'JetBrains Mono', monospace;
      display: inline-flex;
      align-items: center;
      gap: 15px;
      text-transform: uppercase;
      letter-spacing: 2px;
    }

    .ready-btn.not-ready {
      background: linear-gradient(45deg, var(--success), #22c55e);
      color: white;
    }

    .ready-btn.not-ready:hover {
      transform: translateY(-3px);
      box-shadow: 0 15px 35px rgba(74, 222, 128, 0.4);
    }

    .ready-btn.ready {
      background: linear-gradient(45deg, var(--text-secondary), #52525b);
      color: white;
    }

    .ready-btn.ready:hover {
      background: linear-gradient(45deg, #52525b, var(--text-secondary));
    }

    /* Waiting Screen */
    .waiting-screen {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 400px;
      text-align: center;
    }

    .waiting-icon {
      font-size: 5rem;
      margin-bottom: 30px;
      animation: spin 2s linear infinite;
    }

    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }

    .waiting-title {
      font-size: 2.5rem;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 15px;
      text-transform: uppercase;
      letter-spacing: 2px;
    }

    .waiting-subtitle {
      color: var(--text-secondary);
      font-size: 1.2rem;
      font-weight: 500;
    }

    /* Countdown */
    .countdown-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(10, 10, 10, 0.95);
      backdrop-filter: blur(20px);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }

    .countdown-number {
      font-size: 20rem;
      font-weight: 700;
      background: linear-gradient(45deg, var(--accent), var(--accent-secondary), var(--battle));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      text-shadow: 0 0 100px rgba(0, 255, 136, 0.8);
      animation: countdownPulse 1s ease-in-out;
    }

    @keyframes countdownPulse {
      0% { transform: scale(0.5); opacity: 0; }
      50% { transform: scale(1.2); opacity: 1; }
      100% { transform: scale(1); opacity: 1; }
    }

    /* Notification */
    .notification {
      position: fixed;
      top: 100px;
      left: 50%;
      transform: translateX(-50%);
      background: linear-gradient(135deg, var(--bg-secondary), var(--bg-tertiary));
      color: var(--text-primary);
      padding: 15px 30px;
      border-radius: 12px;
      font-weight: 600;
      z-index: 1001;
      border: 2px solid var(--accent);
      font-size: 1rem;
      font-family: 'JetBrains Mono', monospace;
      animation: notificationSlide 0.4s ease;
      backdrop-filter: blur(10px);
    }

    @keyframes notificationSlide {
      from {
        opacity: 0;
        transform: translateX(-50%) translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateX(-50%) translateY(0);
      }
    }

    .notification.success {
      border-color: var(--success);
      color: var(--success);
    }

    .notification.error {
      border-color: var(--error);
      color: var(--error);
    }

    /* Fireworks */
    .fireworks-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      pointer-events: none;
      z-index: 10000;
    }

    .firework {
      position: absolute;
      width: 6px;
      height: 6px;
      border-radius: 50%;
      animation: fireworkExplode 2s ease-out forwards;
    }

    @keyframes fireworkExplode {
      0% {
        transform: scale(0);
        opacity: 1;
      }
      50% {
        transform: scale(1);
        opacity: 1;
      }
      100% {
        transform: scale(2);
        opacity: 0;
      }
    }

    .firework-particle {
      position: absolute;
      width: 4px;
      height: 4px;
      border-radius: 50%;
      animation: particleMove 1.5s ease-out forwards;
    }

    @keyframes particleMove {
      0% {
        transform: translate(0, 0) scale(1);
        opacity: 1;
      }
      100% {
        transform: translate(var(--dx), var(--dy)) scale(0);
        opacity: 0;
      }
    }

    /* Confetti */
    .confetti {
      position: absolute;
      width: 12px;
      height: 12px;
      animation: confettiFall 3s linear infinite;
    }

    @keyframes confettiFall {
      0% {
        transform: translateY(-100vh) rotate(0deg);
        opacity: 1;
      }
      100% {
        transform: translateY(100vh) rotate(360deg);
        opacity: 0;
      }
    }

    /* Mobile Detection */
    @media (max-width: 1024px) {
      .mobile-block {
        display: flex !important;
      }
      
      .battle-layout {
        display: none !important;
      }
    }
  </style>
</head>
<body>
  <div class="bg-animation"></div>

  <!-- Mobile Block Screen -->
  <div class="mobile-block">
    <div class="mobile-block-icon">üñ•Ô∏è</div>
    <div class="mobile-block-title">BU SAYT GA FAQAT KOMPYUTERDAN KIRSA BO'LADI</div>
    <div class="mobile-block-message">
      UZUR<br><br>
      Bu professional typing game faqat kompyuter va katta ekranlar uchun mo'ljallangan.
      Iltimos, kompyuteringizdan foydalaning.
    </div>
  </div>

  <!-- Victory Screen -->
  <div class="victory-screen" id="victoryScreen">
    <div class="fireworks-container" id="fireworksContainer"></div>
    
    <div class="victory-crown">üëë</div>
    <div class="victory-title">champion!</div>
    <div class="winner-name" id="winnerName">Racing Legend</div>
    
    <div class="victory-stats">
      <div class="victory-stat">
        <span class="victory-stat-value" id="victoryWPM">0</span>
        <span class="victory-stat-label">WPM</span>
      </div>
      <div class="victory-stat">
        <span class="victory-stat-value" id="victoryAccuracy">0%</span>
        <span class="victory-stat-label">Accuracy</span>
      </div>
      <div class="victory-stat">
        <span class="victory-stat-value" id="victoryTime">0s</span>
        <span class="victory-stat-label">Time</span>
      </div>
    </div>
    
    <div class="victory-buttons">
      <button class="victory-btn victory-btn-primary" onclick="playAgain()">
        <span>üîÑ</span>
        <span>race again</span>
      </button>
      <button class="victory-btn victory-btn-secondary" onclick="goHome()">
        <span>üè†</span>
        <span>home</span>
      </button>
    </div>
  </div>

  <!-- Countdown Overlay -->
  <div class="countdown-overlay" id="countdownOverlay">
    <div class="countdown-number" id="countdownNumber">3</div>
  </div>

  <!-- Battle Layout -->
  <div class="battle-layout">
    <!-- Header -->
    <div class="header">
      <div class="room-info">
        <div class="room-code" id="roomCode">LOADING...</div>
        <div class="room-status">
          <div class="status-dot waiting" id="statusDot"></div>
          <span id="roomStatus">Waiting for racers...</span>
        </div>
      </div>
      
      <div class="header-actions">
        <button class="btn btn-secondary" onclick="copyRoomCode()">
          <span>üìã</span>
          <span>copy code</span>
        </button>
        <button class="btn btn-battle" onclick="leaveRoom()">
          <span>üö™</span>
          <span>leave race</span>
        </button>
      </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
      <!-- Players Panel -->
      <div class="players-panel">
        <div class="players-title">
          <span>üèéÔ∏è</span>
          <span>racers (<span id="playerCount">0</span>/<span id="maxPlayers">0</span>)</span>
        </div>
        <div id="playersList">
          <!-- Players will be loaded here -->
        </div>
      </div>

      <!-- Game Area -->
      <div class="game-area">
        <div class="game-header">
          <div class="game-timer" id="gameTimer">60</div>
          <div class="game-stats">
            <div class="stat-item">
              <span class="stat-value" id="currentWPM">0</span>
              <span class="stat-label">WPM</span>
            </div>
            <div class="stat-item">
              <span class="stat-value" id="currentAccuracy">100%</span>
              <span class="stat-label">Accuracy</span>
            </div>
            <div class="stat-item">
              <span class="stat-value" id="currentProgress">0%</span>
              <span class="stat-label">Progress</span>
            </div>
          </div>
        </div>

        <!-- Text Display -->
        <div class="text-display">
          <div class="text-content" id="textContent">
            <div class="waiting-screen" id="waitingScreen">
              <div class="waiting-icon">üèÅ</div>
              <div class="waiting-title">preparing race...</div>
              <div class="waiting-subtitle">Get ready for the ultimate typing race!</div>
            </div>
          </div>
        </div>

        <!-- Input Area -->
        <div class="input-area">
          <input type="text" class="typing-input" id="typingInput" placeholder="Type here when the race starts..." disabled>
          <div class="input-hint">Focus on this input and start typing when the race begins</div>
        </div>

        <!-- Ready Section -->
        <div class="ready-section">
          <button class="ready-btn not-ready" id="readyBtn" onclick="toggleReady()">
            <span>üèÅ</span>
            <span>ready to race!</span>
          </button>
        </div>
      </div>
    </div>
  </div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
  import { getDatabase, ref, set, onValue, push, get, remove, serverTimestamp, off } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCR8QE6UHlS8qqp7UIqCxyiXto_xlB0xyI",
    authDomain: "tezroqyoz.firebaseapp.com",
    databaseURL: "https://tezroqyoz-default-rtdb.firebaseio.com",
    projectId: "tezroqyoz",
    storageBucket: "tezroqyoz.firebasestorage.app",
    messagingSenderId: "562891786916",
    appId: "1:562891786916:web:8372d94bf2128fcc127431",
    measurementId: "G-C3F6970S7T"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  const user = JSON.parse(localStorage.getItem("sozUser"));
  if (!user) {
    window.location.href = "register.html";
  }

  const roomCode = localStorage.getItem('battleRoomCode');
  if (!roomCode) {
    window.location.href = 'battle.html';
  }

  // Game state
  let gameState = {
    isRacing: false,
    startTime: null,
    currentText: '',
    typedText: '',
    currentIndex: 0,
    wpm: 0,
    accuracy: 100,
    progress: 0,
    timeLeft: 60,
    position: 1
  };

  let roomData = null;
  let gameTimer = null;
  let isReady = false;

  // Racing texts for battle
  const raceTexts = [
    "The quick brown fox jumps over the lazy dog while racing through the digital highway at lightning speed. Every keystroke matters in this ultimate typing championship where only the fastest fingers will claim victory.",
    "In the world of competitive typing, champions are made through dedication, practice, and unwavering focus. Master the art of touch typing and become the ultimate racing legend in this thrilling digital arena.",
    "Technology has revolutionized the way we communicate and compete in the modern world. Embrace the challenge, push your limits, and prove that you have what it takes to be the fastest typist alive.",
    "Speed and accuracy are the twin pillars of typing mastery. Balance both elements perfectly as you race against time and opponents in this high-stakes digital competition where every character counts.",
    "The art of touch typing is more than just a skill - it's a superpower that separates the champions from the rest. Train your fingers, sharpen your mind, and dominate the leaderboard with your incredible speed."
  ];

  // Initialize room
  async function initializeRoom() {
    document.getElementById('roomCode').textContent = roomCode;
    
    // Listen to room changes
    const roomRef = ref(db, `battleRooms/${roomCode}`);
    onValue(roomRef, (snapshot) => {
      if (snapshot.exists()) {
        roomData = snapshot.val();
        updateRoomDisplay();
        updatePlayersDisplay();
        checkGameStart();
      } else {
        showNotification('‚ùå Race not found!', 'error');
        setTimeout(() => {
          window.location.href = 'battle.html';
        }, 2000);
      }
    });
  }

  // Update room display
  function updateRoomDisplay() {
    if (!roomData) return;

    document.getElementById('maxPlayers').textContent = roomData.maxPlayers;
    document.getElementById('playerCount').textContent = roomData.currentPlayers;
    
    const statusDot = document.getElementById('statusDot');
    const roomStatus = document.getElementById('roomStatus');
    
    switch (roomData.status) {
      case 'waiting':
        statusDot.className = 'status-dot waiting';
        roomStatus.textContent = 'Waiting for racers...';
        break;
      case 'countdown':
        statusDot.className = 'status-dot ready';
        roomStatus.textContent = 'Race starting soon!';
        break;
      case 'racing':
        statusDot.className = 'status-dot racing';
        roomStatus.textContent = 'Race in progress!';
        break;
      case 'finished':
        statusDot.className = 'status-dot';
        roomStatus.textContent = 'Race finished!';
        break;
    }
  }

  // Update players display
  function updatePlayersDisplay() {
    if (!roomData || !roomData.players) return;

    const playersList = document.getElementById('playersList');
    const players = Object.values(roomData.players);
    
    // Sort players by progress (racing position)
    players.sort((a, b) => (b.progress || 0) - (a.progress || 0));

    playersList.innerHTML = players.map((player, index) => {
      const isHost = player.phone === roomData.host;
      const isCurrentUser = player.phone === user.phone;
      const position = index + 1;
      
      let positionEmoji = 'üèéÔ∏è';
      if (roomData.status === 'racing' || roomData.status === 'finished') {
        if (position === 1) positionEmoji = 'ü•á';
        else if (position === 2) positionEmoji = 'ü•à';
        else if (position === 3) positionEmoji = 'ü•â';
        else positionEmoji = `${position}Ô∏è‚É£`;
      }
      
      return `
        <div class="player-card ${player.ready ? 'ready' : ''} ${isHost ? 'host' : ''} ${roomData.status === 'racing' ? 'racing' : ''}">
          <div class="player-header">
            <div class="player-name">
              <span class="player-position">${positionEmoji}</span>
              <span>${player.name}</span>
              ${isHost ? '<span class="player-badge badge-host">üëë Host</span>' : ''}
              ${isCurrentUser ? '<span style="opacity: 0.7;">(You)</span>' : ''}
            </div>
            <span class="player-badge ${
              roomData.status === 'racing' ? 'badge-racing' :
              player.ready ? 'badge-ready' : 'badge-waiting'
            }">
              ${
                roomData.status === 'racing' ? 'üèÅ Racing' :
                player.ready ? '‚úÖ Ready' : '‚è≥ Waiting'
              }
            </span>
          </div>
          <div class="player-stats">
            <span>WPM: ${Math.round(player.wpm || 0)}</span>
            <span>Progress: ${Math.round(player.progress || 0)}%</span>
            <span>Accuracy: ${Math.round(player.accuracy || 100)}%</span>
          </div>
          <div class="player-progress">
            <div class="progress-bar" style="width: ${player.progress || 0}%"></div>
          </div>
        </div>
      `;
    }).join('');

    // Update ready button state
    const currentPlayer = roomData.players[user.phone];
    if (currentPlayer) {
      isReady = currentPlayer.ready;
      updateReadyButton();
    }
  }

  // Toggle ready state
  window.toggleReady = async function() {
    if (!roomData || gameState.isRacing) return;

    isReady = !isReady;
    
    try {
      await set(ref(db, `battleRooms/${roomCode}/players/${user.phone}/ready`), isReady);
      updateReadyButton();
      
      if (isReady) {
        showNotification('‚úÖ You are ready to race!', 'success');
      } else {
        showNotification('‚è≥ You are not ready', 'info');
      }
    } catch (error) {
      console.error('Error updating ready state:', error);
      showNotification('‚ùå Error updating ready state!', 'error');
    }
  }

  // Update ready button
  function updateReadyButton() {
    const readyBtn = document.getElementById('readyBtn');
    
    if (gameState.isRacing) {
      readyBtn.style.display = 'none';
      return;
    }
    
    if (isReady) {
      readyBtn.className = 'ready-btn ready';
      readyBtn.innerHTML = '<span>‚è≥</span><span>cancel ready</span>';
    } else {
      readyBtn.className = 'ready-btn not-ready';
      readyBtn.innerHTML = '<span>üèÅ</span><span>ready to race!</span>';
    }
  }

  // Check if game should start
  function checkGameStart() {
    if (!roomData || !roomData.players) return;

    const players = Object.values(roomData.players);
    const allReady = players.length >= 2 && players.every(player => player.ready);
    
    if (allReady && roomData.status === 'waiting') {
      startCountdown();
    }
  }

  // Start countdown
  async function startCountdown() {
    try {
      await set(ref(db, `battleRooms/${roomCode}/status`), 'countdown');
      
      const countdownOverlay = document.getElementById('countdownOverlay');
      const countdownNumber = document.getElementById('countdownNumber');
      
      countdownOverlay.style.display = 'flex';
      
      for (let i = 3; i > 0; i--) {
        countdownNumber.textContent = i;
        countdownNumber.style.animation = 'none';
        setTimeout(() => {
          countdownNumber.style.animation = 'countdownPulse 1s ease-in-out';
        }, 10);
        
        // Play countdown sound
        playSound('countdown');
        
        await new Promise(resolve => setTimeout(resolve, 1000));
      }
      
      countdownNumber.textContent = 'GO!';
      countdownNumber.style.background = 'linear-gradient(45deg, var(--success), var(--accent))';
      countdownNumber.style.webkitBackgroundClip = 'text';
      countdownNumber.style.webkitTextFillColor = 'transparent';
      playSound('start');
      
      setTimeout(() => {
        countdownOverlay.style.display = 'none';
        startRace();
      }, 1000);
      
    } catch (error) {
      console.error('Error starting countdown:', error);
    }
  }

  // Start race
  async function startRace() {
    try {
      // Select random text
      const selectedText = raceTexts[Math.floor(Math.random() * raceTexts.length)];
      
      await set(ref(db, `battleRooms/${roomCode}/status`), 'racing');
      await set(ref(db, `battleRooms/${roomCode}/gameText`), selectedText);
      await set(ref(db, `battleRooms/${roomCode}/startTime`), Date.now());
      
      // Initialize game state
      gameState.isRacing = true;
      gameState.startTime = Date.now();
      gameState.currentText = selectedText;
      gameState.typedText = '';
      gameState.currentIndex = 0;
      gameState.timeLeft = 60;
      
      // Show game text
      displayGameText();
      
      // Enable input
      const typingInput = document.getElementById('typingInput');
      typingInput.disabled = false;
      typingInput.placeholder = 'Start typing...';
      typingInput.focus();
      
      // Hide waiting screen and ready button
      document.getElementById('waitingScreen').style.display = 'none';
      document.getElementById('readyBtn').style.display = 'none';
      
      // Start timer
      startGameTimer();
      
      showNotification('üöÄ Race started!', 'success');
      
    } catch (error) {
      console.error('Error starting race:', error);
    }
  }

  // Display game text
  function displayGameText() {
    const textContent = document.getElementById('textContent');
    const text = gameState.currentText;
    
    let html = '';
    for (let i = 0; i < text.length; i++) {
      const char = text[i];
      let className = 'char';
      
      if (i < gameState.currentIndex) {
        className += gameState.typedText[i] === char ? ' correct' : ' incorrect';
      } else if (i === gameState.currentIndex) {
        className += ' current';
      }
      
      html += `<span class="${className}">${char === ' ' ? '&nbsp;' : char}</span>`;
    }
    
    textContent.innerHTML = html;
  }

  // Start game timer
  function startGameTimer() {
    gameTimer = setInterval(() => {
      gameState.timeLeft--;
      document.getElementById('gameTimer').textContent = gameState.timeLeft;
      
      if (gameState.timeLeft <= 0) {
        endRace();
      }
    }, 1000);
  }

  // Handle typing
  document.getElementById('typingInput').addEventListener('input', (e) => {
    if (!gameState.isRacing) return;
    
    const input = e.target.value;
    gameState.typedText = input;
    gameState.currentIndex = input.length;
    
    // Update display
    displayGameText();
    updateStats();
    updateProgress();
    
    // Check if finished
    if (input.length >= gameState.currentText.length) {
      endRace();
    }
  });

  // Update stats
  function updateStats() {
    const timeElapsed = (Date.now() - gameState.startTime) / 1000;
    const wordsTyped = gameState.typedText.length / 5;
    const wpm = timeElapsed > 0 ? Math.round((wordsTyped / timeElapsed) * 60) : 0;
    
    let correctChars = 0;
    for (let i = 0; i < gameState.typedText.length; i++) {
      if (gameState.typedText[i] === gameState.currentText[i]) {
        correctChars++;
      }
    }
    
    const accuracy = gameState.typedText.length > 0 ? Math.round((correctChars / gameState.typedText.length) * 100) : 100;
    const progress = Math.round((gameState.typedText.length / gameState.currentText.length) * 100);
    
    gameState.wpm = wpm;
    gameState.accuracy = accuracy;
    gameState.progress = progress;
    
    document.getElementById('currentWPM').textContent = wpm;
    document.getElementById('currentAccuracy').textContent = accuracy + '%';
    document.getElementById('currentProgress').textContent = progress + '%';
  }

  // Update progress in database
  async function updateProgress() {
    try {
      await set(ref(db, `battleRooms/${roomCode}/players/${user.phone}/wpm`), gameState.wpm);
      await set(ref(db, `battleRooms/${roomCode}/players/${user.phone}/progress`), gameState.progress);
      await set(ref(db, `battleRooms/${roomCode}/players/${user.phone}/accuracy`), gameState.accuracy);
    } catch (error) {
      console.error('Error updating progress:', error);
    }
  }

  // End race
  async function endRace() {
    if (!gameState.isRacing) return;
    
    gameState.isRacing = false;
    clearInterval(gameTimer);
    
    // Disable input
    document.getElementById('typingInput').disabled = true;
    
    try {
      // Update final stats
      await set(ref(db, `battleRooms/${roomCode}/players/${user.phone}/finalWPM`), gameState.wpm);
      await set(ref(db, `battleRooms/${roomCode}/players/${user.phone}/finalAccuracy`), gameState.accuracy);
      await set(ref(db, `battleRooms/${roomCode}/players/${user.phone}/finalProgress`), gameState.progress);
      await set(ref(db, `battleRooms/${roomCode}/players/${user.phone}/finished`), true);
      await set(ref(db, `battleRooms/${roomCode}/players/${user.phone}/finishTime`), Date.now());
      
      // Check if all players finished
      checkRaceEnd();
      
    } catch (error) {
      console.error('Error ending race:', error);
    }
  }

  // Check if race should end
  async function checkRaceEnd() {
    if (!roomData || !roomData.players) return;
    
    const players = Object.values(roomData.players);
    const allFinished = players.every(player => player.finished || false);
    
    if (allFinished) {
      await set(ref(db, `battleRooms/${roomCode}/status`), 'finished');
      
      // Determine winner (highest progress, then highest WPM, then fastest finish time)
      const winner = players.reduce((prev, current) => {
        const prevScore = (prev.finalProgress || 0) * 1000 + (prev.finalWPM || 0);
        const currentScore = (current.finalProgress || 0) * 1000 + (current.finalWPM || 0);
        
        if (currentScore > prevScore) return current;
        if (currentScore === prevScore) {
          return (current.finishTime || Infinity) < (prev.finishTime || Infinity) ? current : prev;
        }
        return prev;
      });
      
      await set(ref(db, `battleRooms/${roomCode}/winner`), winner);
      
      // Update user stats
      if (winner.phone === user.phone) {
        const userRef = ref(db, `users/${user.phone}`);
        const userSnapshot = await get(userRef);
        if (userSnapshot.exists()) {
          const userData = userSnapshot.val();
          await set(userRef, {
            ...userData,
            battleWins: (userData.battleWins || 0) + 1,
            battleGames: (userData.battleGames || 0) + 1
          });
        }
      } else {
        const userRef = ref(db, `users/${user.phone}`);
        const userSnapshot = await get(userRef);
        if (userSnapshot.exists()) {
          const userData = userSnapshot.val();
          await set(userRef, {
            ...userData,
            battleGames: (userData.battleGames || 0) + 1
          });
        }
      }
      
      // Show victory screen
      setTimeout(() => {
        showVictoryScreen(winner);
      }, 1000);
    }
  }

  // Show victory screen
  function showVictoryScreen(winner) {
    const victoryScreen = document.getElementById('victoryScreen');
    const winnerName = document.getElementById('winnerName');
    const victoryWPM = document.getElementById('victoryWPM');
    const victoryAccuracy = document.getElementById('victoryAccuracy');
    const victoryTime = document.getElementById('victoryTime');
    
    winnerName.textContent = winner.name;
    victoryWPM.textContent = Math.round(winner.finalWPM || 0);
    victoryAccuracy.textContent = Math.round(winner.finalAccuracy || 0) + '%';
    victoryTime.textContent = (60 - gameState.timeLeft) + 's';
    
    victoryScreen.style.display = 'flex';
    
    // Create fireworks
    createFireworks();
    createConfetti();
    
    // Play victory sound
    playSound('victory');
  }

  // Create fireworks
  function createFireworks() {
    const container = document.getElementById('fireworksContainer');
    const colors = ['#00ff88', '#ff6b35', '#ff3366', '#ffd700', '#4ade80'];
    
    for (let i = 0; i < 8; i++) {
      setTimeout(() => {
        const firework = document.createElement('div');
        firework.className = 'firework';
        firework.style.left = Math.random() * 100 + '%';
        firework.style.top = Math.random() * 100 + '%';
        firework.style.background = colors[Math.floor(Math.random() * colors.length)];
        
        container.appendChild(firework);
        
        // Create particles
        for (let j = 0; j < 15; j++) {
          const particle = document.createElement('div');
          particle.className = 'firework-particle';
          particle.style.left = firework.style.left;
          particle.style.top = firework.style.top;
          particle.style.background = colors[Math.floor(Math.random() * colors.length)];
          
          const angle = (j * 24) * Math.PI / 180;
          const distance = 100 + Math.random() * 150;
          particle.style.setProperty('--dx', Math.cos(angle) * distance + 'px');
          particle.style.setProperty('--dy', Math.sin(angle) * distance + 'px');
          
          container.appendChild(particle);
          
          setTimeout(() => particle.remove(), 1500);
        }
        
        setTimeout(() => firework.remove(), 2000);
      }, i * 300);
    }
  }

  // Create confetti
  function createConfetti() {
    const colors = ['#00ff88', '#ff6b35', '#ff3366', '#ffd700', '#4ade80'];
    
    for (let i = 0; i < 100; i++) {
      setTimeout(() => {
        const confetti = document.createElement('div');
        confetti.className = 'confetti';
        confetti.style.left = Math.random() * 100 + '%';
        confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
        confetti.style.animationDelay = Math.random() * 3 + 's';
        confetti.style.animationDuration = (Math.random() * 3 + 2) + 's';
        
        document.body.appendChild(confetti);
        
        setTimeout(() => confetti.remove(), 6000);
      }, i * 50);
    }
  }

  // Play sound
  function playSound(type) {
    // Create audio context for sound effects
    try {
      const audioContext = new (window.AudioContext || window.webkitAudioContext)();
      
      let frequency, duration;
      
      switch (type) {
        case 'countdown':
          frequency = 800;
          duration = 0.1;
          break;
        case 'start':
          frequency = 1200;
          duration = 0.3;
          break;
        case 'victory':
          // Play victory melody
          const notes = [523, 659, 784, 1047, 1319];
          notes.forEach((freq, index) => {
            setTimeout(() => {
              const oscillator = audioContext.createOscillator();
              const gainNode = audioContext.createGain();
              
              oscillator.connect(gainNode);
              gainNode.connect(audioContext.destination);
              
              oscillator.frequency.value = freq;
              oscillator.type = 'sine';
              
              gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
              gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
              
              oscillator.start(audioContext.currentTime);
              oscillator.stop(audioContext.currentTime + 0.5);
            }, index * 150);
          });
          return;
        default:
          return;
      }
      
      const oscillator = audioContext.createOscillator();
      const gainNode = audioContext.createGain();
      
      oscillator.connect(gainNode);
      gainNode.connect(audioContext.destination);
      
      oscillator.frequency.value = frequency;
      oscillator.type = 'sine';
      
      gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
      gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);
      
      oscillator.start(audioContext.currentTime);
      oscillator.stop(audioContext.currentTime + duration);
    } catch (error) {
      console.log('Audio not supported');
    }
  }

  // Copy room code
  window.copyRoomCode = function() {
    navigator.clipboard.writeText(roomCode).then(() => {
      showNotification('üìã Race code copied!', 'success');
    });
  }

  // Leave room
  window.leaveRoom = async function() {
    if (confirm('Are you sure you want to leave the race?')) {
      try {
        // Remove player from room
        await remove(ref(db, `battleRooms/${roomCode}/players/${user.phone}`));
        
        // Update player count
        if (roomData && roomData.currentPlayers > 1) {
          await set(ref(db, `battleRooms/${roomCode}/currentPlayers`), roomData.currentPlayers - 1);
        } else {
          // Delete room if last player
          await remove(ref(db, `battleRooms/${roomCode}`));
        }
        
        localStorage.removeItem('battleRoomCode');
        window.location.href = 'battle.html';
        
      } catch (error) {
        console.error('Error leaving room:', error);
        showNotification('‚ùå Error leaving race!', 'error');
      }
    }
  }

  // Victory screen actions
  window.playAgain = function() {
    window.location.reload();
  }

  window.goHome = function() {
    localStorage.removeItem('battleRoomCode');
    window.location.href = 'index.html';
  }

  // Notification system
  function showNotification(message, type = 'info') {
    const notification = document.createElement('div');
    notification.className = `notification ${type}`;
    notification.textContent = message;
    document.body.appendChild(notification);
    
    setTimeout(() => {
      notification.remove();
    }, 4000);
  }

  // Initialize
  initializeRoom();

  // Cleanup on page unload
  window.addEventListener('beforeunload', () => {
    if (roomData && roomData.players && roomData.players[user.phone]) {
      // Remove player from room
      remove(ref(db, `battleRooms/${roomCode}/players/${user.phone}`));
    }
  });
</script>

<script>
  function showInsult() {
    alert("Urinma! Baribir hech nima qilolmaysan.\nKod senga emas! üö´ü§¨");

    document.body.innerHTML = `
      <div style="display:flex;justify-content:center;align-items:center;height:100vh;background:black;color:crimson;font-size:30px;font-family:'Arial';text-align:center;padding:20px;">
        <div>
          <p>üö® URINMA! üö®</p>
          <p>Sen nimani bosma, kodni ololmaysan!</p>
          <p><b>–°–∞–π—Ç–Ω–∏ —Å–Ω–æ—Å–∏–º–∞–Ω, –±–æ—à“õ–∞ “õ–∞–π—Ç–º–∞!</b></p>
          <p><i>‰Ω†Êó†ËÆ∫Êåâ‰ªÄ‰πàÈîÆÔºåÈÉΩÊó†Ê≥ïÁúãÂà∞Ê∫ê‰ª£Á†ÅÔºÅ</i></p>
          <p><u>–ö–æ–¥–Ω–∏ –æ–ª–∏—à –º—É–º–∫–∏–Ω —ç–º–∞—Å, –∞—Ö–º–æ“õ!</u></p>
        </div>
      </div>
    `;
  }

  const blockedKeys = ['u', 'U', 'g', 'G', '–ø', '–ü', 'c', 'C', 's', 'S', 'i', 'I', 'j', 'J'];

  window.addEventListener("keydown", function (e) {
    const key = e.key.toLowerCase();
    
    if (
      e.keyCode === 123 || 
      (e.ctrlKey && blockedKeys.includes(e.key)) || 
      (e.ctrlKey && e.shiftKey && blockedKeys.includes(e.key))
    ) {
      e.preventDefault();
      showInsult();
    }
  });

  window.addEventListener("contextmenu", function (e) {
    e.preventDefault();
    showInsult();
  });

  document.addEventListener("copy", function (e) {
    e.preventDefault();
    showInsult();
  });

  (function devtoolsDetector() {
    const detector = new Function("debugger");
    setInterval(() => detector(), 100);
  })();

  if (window.top !== window.self) {
    window.top.location = window.self.location;
  }
</script>

<script src="js/protection.js"></script>

</body>
</html>
