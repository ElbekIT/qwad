<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üë• Do'stlar - Tez Roq Yoz</title>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-primary: #1a1a1a;
      --bg-secondary: #2c2c2c;
      --bg-tertiary: #3c3c3c;
      --text-primary: #e2b714;
      --text-secondary: #646669;
      --accent: #e2b714;
      --success: #4ade80;
      --error: #ef4444;
      --warning: #f59e0b;
      --border: #3c3c3c;
      --online: #22c55e;
      --offline: #6b7280;
    }

    [data-theme="light"] {
      --bg-primary: #ffffff;
      --bg-secondary: #f8f9fa;
      --bg-tertiary: #e9ecef;
      --text-primary: #1a1a1a;
      --text-secondary: #6c757d;
      --accent: #e2b714;
      --border: #e9ecef;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html, body {
      height: 100vh;
      font-family: 'JetBrains Mono', monospace;
      background: var(--bg-primary);
      color: var(--text-primary);
      overflow: hidden;
      transition: all 0.3s ease;
    }

    /* Mobile Block */
    .mobile-block {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: var(--bg-primary);
      z-index: 9999;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: 40px 20px;
    }

    .mobile-block-icon {
      font-size: 5rem;
      margin-bottom: 30px;
      opacity: 0.8;
    }

    .mobile-block-title {
      font-size: 2rem;
      font-weight: 700;
      color: var(--accent);
      margin-bottom: 20px;
      line-height: 1.2;
    }

    .mobile-block-message {
      font-size: 1.2rem;
      color: var(--text-secondary);
      line-height: 1.5;
      max-width: 400px;
    }

    /* Main Layout */
    .main-layout {
      height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* Header */
    .header {
      height: 60px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 40px;
      background: var(--bg-primary);
      border-bottom: 1px solid var(--border);
    }

    .header-title {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .header-icon {
      font-size: 1.8rem;
      color: var(--accent);
    }

    .header-text {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--text-primary);
    }

    .header-controls {
      display: flex;
      align-items: center;
      gap: 20px;
    }

    .theme-toggle {
      background: none;
      border: none;
      color: var(--text-secondary);
      cursor: pointer;
      font-size: 1.2rem;
      padding: 8px;
      border-radius: 6px;
      transition: all 0.2s;
    }

    .theme-toggle:hover {
      background: var(--bg-secondary);
      color: var(--text-primary);
    }

    .back-btn {
      background: var(--bg-secondary);
      color: var(--text-primary);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 8px 16px;
      font-size: 0.9rem;
      cursor: pointer;
      transition: all 0.2s;
      font-family: 'JetBrains Mono', monospace;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .back-btn:hover {
      background: var(--bg-tertiary);
    }

    /* Main Content */
    .main-content {
      flex: 1;
      display: flex;
      max-width: 1200px;
      margin: 0 auto;
      width: 100%;
      overflow: hidden;
    }

    /* Sidebar */
    .sidebar {
      width: 300px;
      background: var(--bg-secondary);
      border-right: 1px solid var(--border);
      display: flex;
      flex-direction: column;
    }

    .sidebar-header {
      padding: 20px;
      border-bottom: 1px solid var(--border);
    }

    .add-friend-form {
      display: flex;
      gap: 10px;
      margin-bottom: 15px;
    }

    .friend-input {
      flex: 1;
      background: var(--bg-primary);
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 8px 12px;
      color: var(--text-primary);
      font-size: 0.9rem;
      outline: none;
      transition: border-color 0.2s;
      font-family: 'JetBrains Mono', monospace;
    }

    .friend-input:focus {
      border-color: var(--accent);
    }

    .add-btn {
      background: var(--accent);
      color: var(--bg-primary);
      border: none;
      border-radius: 6px;
      padding: 8px 12px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      font-family: 'JetBrains Mono', monospace;
    }

    .add-btn:hover {
      background: #d4a813;
    }

    .sidebar-tabs {
      display: flex;
      background: var(--bg-primary);
      border-radius: 6px;
      padding: 2px;
    }

    .tab-btn {
      flex: 1;
      background: none;
      border: none;
      color: var(--text-secondary);
      padding: 8px 12px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.8rem;
      font-weight: 500;
      transition: all 0.2s;
      font-family: 'JetBrains Mono', monospace;
    }

    .tab-btn.active {
      background: var(--accent);
      color: var(--bg-primary);
    }

    .sidebar-content {
      flex: 1;
      overflow-y: auto;
      padding: 10px;
    }

    /* Friend Item */
    .friend-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
      margin-bottom: 5px;
      position: relative;
    }

    .friend-item:hover {
      background: var(--bg-tertiary);
    }

    .friend-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: var(--accent);
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--bg-primary);
      font-weight: 600;
      position: relative;
      flex-shrink: 0;
    }

    .status-indicator {
      position: absolute;
      bottom: 0;
      right: 0;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      border: 2px solid var(--bg-secondary);
    }

    .status-online {
      background: var(--online);
    }

    .status-offline {
      background: var(--offline);
    }

    .friend-info {
      flex: 1;
      min-width: 0;
    }

    .friend-name {
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 2px;
      font-size: 0.9rem;
    }

    .friend-status {
      font-size: 0.7rem;
      color: var(--text-secondary);
    }

    .friend-actions {
      display: flex;
      gap: 5px;
    }

    .action-btn {
      background: none;
      border: none;
      color: var(--text-secondary);
      cursor: pointer;
      padding: 4px;
      border-radius: 4px;
      font-size: 0.8rem;
      transition: all 0.2s;
    }

    .action-btn:hover {
      background: var(--bg-primary);
      color: var(--text-primary);
    }

    .action-btn.accept {
      color: var(--success);
    }

    .action-btn.reject {
      color: var(--error);
    }

    /* Main Panel */
    .main-panel {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: 40px;
    }

    .empty-state {
      max-width: 400px;
    }

    .empty-icon {
      font-size: 4rem;
      margin-bottom: 20px;
      opacity: 0.7;
    }

    .empty-title {
      font-size: 1.5rem;
      font-weight: 600;
      margin-bottom: 10px;
      color: var(--text-primary);
    }

    .empty-description {
      font-size: 1rem;
      color: var(--text-secondary);
      line-height: 1.5;
      margin-bottom: 30px;
    }

    .quick-actions {
      display: flex;
      gap: 15px;
      justify-content: center;
      flex-wrap: wrap;
    }

    .quick-btn {
      background: var(--bg-secondary);
      color: var(--text-primary);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 12px 20px;
      font-size: 0.9rem;
      cursor: pointer;
      transition: all 0.2s;
      font-family: 'JetBrains Mono', monospace;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .quick-btn:hover {
      background: var(--bg-tertiary);
      transform: translateY(-1px);
    }

    .quick-btn.primary {
      background: var(--accent);
      color: var(--bg-primary);
      border-color: var(--accent);
    }

    .quick-btn.primary:hover {
      background: #d4a813;
    }

    /* Notifications Panel */
    .notifications-panel {
      flex: 1;
      padding: 20px;
      overflow-y: auto;
    }

    .notification-item {
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 10px;
      transition: all 0.2s;
    }

    .notification-item.unread {
      border-color: var(--accent);
      box-shadow: 0 0 10px rgba(226, 183, 20, 0.2);
    }

    .notification-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 8px;
    }

    .notification-type {
      display: flex;
      align-items: center;
      gap: 8px;
      font-weight: 600;
      color: var(--accent);
      font-size: 0.9rem;
    }

    .notification-time {
      font-size: 0.7rem;
      color: var(--text-secondary);
    }

    .notification-content {
      color: var(--text-primary);
      line-height: 1.4;
      margin-bottom: 10px;
    }

    .notification-actions {
      display: flex;
      gap: 10px;
    }

    .notif-btn {
      background: var(--bg-primary);
      color: var(--text-primary);
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 6px 12px;
      font-size: 0.8rem;
      cursor: pointer;
      transition: all 0.2s;
      font-family: 'JetBrains Mono', monospace;
    }

    .notif-btn:hover {
      background: var(--bg-tertiary);
    }

    .notif-btn.accept {
      background: var(--success);
      color: white;
      border-color: var(--success);
    }

    .notif-btn.reject {
      background: var(--error);
      color: white;
      border-color: var(--error);
    }

    /* Mobile Detection */
    @media (max-width: 1024px) {
      .mobile-block {
        display: flex !important;
      }
      
      .main-layout {
        display: none !important;
      }
    }

    /* Responsive */
    @media (min-width: 1025px) and (max-width: 1200px) {
      .header {
        padding: 0 20px;
      }
      
      .sidebar {
        width: 250px;
      }
    }
  </style>
</head>
<body data-theme="dark">
  <!-- Mobile Block Screen -->
  <div class="mobile-block">
    <div class="mobile-block-icon">üñ•Ô∏è</div>
    <div class="mobile-block-title">BU SAYT GA FAQAT KOMPYUTERDAN KIRSA BO'LADI</div>
    <div class="mobile-block-message">
      UZUR<br><br>
      Bu professional typing game faqat kompyuter va katta ekranlar uchun mo'ljallangan.
      Iltimos, kompyuteringizdan foydalaning.
    </div>
  </div>

  <!-- Main Layout -->
  <div class="main-layout">
    <!-- Header -->
    <div class="header">
      <div class="header-title">
        <div class="header-icon">üë•</div>
        <div class="header-text">Do'stlar va Bildirishnomalar</div>
      </div>
      
      <div class="header-controls">
        <button class="theme-toggle" onclick="toggleTheme()" title="Tema o'zgartirish">
          <span id="themeIcon">üåô</span>
        </button>
        
        <button class="back-btn" onclick="location.href='index.html'">
          <span>‚¨ÖÔ∏è</span>
          <span>bosh sahifa</span>
        </button>
      </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
      <!-- Sidebar -->
      <div class="sidebar">
        <div class="sidebar-header">
          <div class="add-friend-form">
            <input 
              type="text" 
              class="friend-input" 
              id="friendPhone" 
              placeholder="Telefon raqami (+998901234567)"
              maxlength="13"
            />
            <button class="add-btn" onclick="sendFriendRequest()">
              <span>‚ûï</span>
            </button>
          </div>
          
          <div class="sidebar-tabs">
            <button class="tab-btn active" onclick="switchTab('friends')" id="friendsTab">
              Do'stlar (<span id="friendsCount">0</span>)
            </button>
            <button class="tab-btn" onclick="switchTab('notifications')" id="notificationsTab">
              Bildirishnomalar (<span id="notifCount">0</span>)
            </button>
          </div>
        </div>
        
        <div class="sidebar-content" id="sidebarContent">
          <!-- Content will be populated by JavaScript -->
        </div>
      </div>

      <!-- Main Panel -->
      <div class="main-panel" id="mainPanel">
        <div class="empty-state">
          <div class="empty-icon">üë•</div>
          <div class="empty-title">Do'stlar bilan bog'laning</div>
          <div class="empty-description">
            Do'stlaringizni qo'shing va ular bilan chat qiling. 
            Telefon raqamini kiritib do'stlik so'rovi yuboring.
          </div>
          <div class="quick-actions">
            <button class="quick-btn primary" onclick="document.getElementById('friendPhone').focus()">
              <span>‚ûï</span>
              <span>Do'st qo'shish</span>
            </button>
            <button class="quick-btn" onclick="location.href='feedback.html'">
              <span>üí≠</span>
              <span>Fikr bildirish</span>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
  import { getDatabase, ref, set, get, onValue, push, remove, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCR8QE6UHlS8qqp7UIqCxyiXto_xlB0xyI",
    authDomain: "tezroqyoz.firebaseapp.com",
    databaseURL: "https://tezroqyoz-default-rtdb.firebaseio.com",
    projectId: "tezroqyoz",
    storageBucket: "tezroqyoz.firebasestorage.app",
    messagingSenderId: "562891786916",
    appId: "1:562891786916:web:8372d94bf2128fcc127431",
    measurementId: "G-C3F6970S7T"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  const user = JSON.parse(localStorage.getItem("sozUser"));
  if (!user) window.location.href = "register.html";

  let currentTab = 'friends';
  let friends = [];
  let notifications = [];

  // Theme System
  function toggleTheme() {
    const body = document.body;
    const themeIcon = document.getElementById('themeIcon');
    const currentTheme = body.getAttribute('data-theme');
    
    if (currentTheme === 'dark') {
      body.setAttribute('data-theme', 'light');
      themeIcon.textContent = '‚òÄÔ∏è';
      localStorage.setItem('theme', 'light');
    } else {
      body.setAttribute('data-theme', 'dark');
      themeIcon.textContent = 'üåô';
      localStorage.setItem('theme', 'dark');
    }
  }

  // Switch tabs
  window.switchTab = function(tab) {
    currentTab = tab;
    
    // Update tab buttons
    document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
    document.getElementById(tab + 'Tab').classList.add('active');
    
    // Update content
    if (tab === 'friends') {
      displayFriends();
    } else {
      displayNotifications();
    }
  }

  // Send friend request
  window.sendFriendRequest = async function() {
    const phoneInput = document.getElementById('friendPhone');
    let phone = phoneInput.value.trim();
    
    if (!phone) {
      showNotification('‚ùå Telefon raqamini kiriting!', 'error');
      return;
    }
    
    // Format phone number
    if (!phone.startsWith('+998')) {
      if (phone.startsWith('998')) {
        phone = '+' + phone;
      } else if (phone.startsWith('9')) {
        phone = '+998' + phone;
      } else {
        phone = '+998' + phone;
      }
    }
    
    if (phone === user.phone) {
      showNotification('‚ùå O\'zingizga so\'rov yubora olmaysiz!', 'error');
      return;
    }
    
    try {
      // Check if user exists
      const targetUserRef = ref(db, `users/${phone}`);
      const targetUserSnapshot = await get(targetUserRef);
      
      if (!targetUserSnapshot.exists()) {
        showNotification('‚ùå Bunday foydalanuvchi topilmadi!', 'error');
        return;
      }
      
      const targetUser = targetUserSnapshot.val();
      
      // Check if already friends
      const friendshipRef = ref(db, `friends/${user.phone}/${phone}`);
      const friendshipSnapshot = await get(friendshipRef);
      
      if (friendshipSnapshot.exists()) {
        showNotification('‚ùå Bu foydalanuvchi allaqachon do\'stingiz!', 'error');
        return;
      }
      
      // Check if request already sent
      const requestRef = ref(db, `friendRequests/${phone}/${user.phone}`);
      const requestSnapshot = await get(requestRef);
      
      if (requestSnapshot.exists()) {
        showNotification('‚ùå So\'rov allaqachon yuborilgan!', 'error');
        return;
      }
      
      // Send friend request
      await set(requestRef, {
        from: user.phone,
        fromName: user.name,
        to: phone,
        toName: targetUser.name,
        timestamp: Date.now(),
        status: 'pending'
      });
      
      // Send notification
      const notificationRef = push(ref(db, `notifications/${phone}`));
      await set(notificationRef, {
        type: 'friend_request',
        from: user.phone,
        fromName: user.name,
        message: `${user.name} sizga do'stlik so'rovi yubordi`,
        timestamp: Date.now(),
        read: false
      });
      
      phoneInput.value = '';
      showNotification('‚úÖ Do\'stlik so\'rovi yuborildi!', 'success');
      
    } catch (error) {
      console.error('Error sending friend request:', error);
      showNotification('‚ùå So\'rov yuborishda xatolik!', 'error');
    }
  }

  // Accept friend request
  window.acceptFriendRequest = async function(fromPhone, fromName) {
    try {
      // Add to friends list (both ways)
      await set(ref(db, `friends/${user.phone}/${fromPhone}`), {
        name: fromName,
        phone: fromPhone,
        timestamp: Date.now(),
        status: 'online'
      });
      
      await set(ref(db, `friends/${fromPhone}/${user.phone}`), {
        name: user.name,
        phone: user.phone,
        timestamp: Date.now(),
        status: 'online'
      });
      
      // Remove friend request
      await remove(ref(db, `friendRequests/${user.phone}/${fromPhone}`));
      
      // Send notification to requester
      const notificationRef = push(ref(db, `notifications/${fromPhone}`));
      await set(notificationRef, {
        type: 'friend_accepted',
        from: user.phone,
        fromName: user.name,
        message: `${user.name} do'stlik so'rovingizni qabul qildi`,
        timestamp: Date.now(),
        read: false
      });
      
      showNotification('‚úÖ Do\'stlik so\'rovi qabul qilindi!', 'success');
      
    } catch (error) {
      console.error('Error accepting friend request:', error);
      showNotification('‚ùå So\'rovni qabul qilishda xatolik!', 'error');
    }
  }

  // Reject friend request
  window.rejectFriendRequest = async function(fromPhone) {
    try {
      await remove(ref(db, `friendRequests/${user.phone}/${fromPhone}`));
      showNotification('‚úÖ Do\'stlik so\'rovi rad etildi!', 'success');
    } catch (error) {
      console.error('Error rejecting friend request:', error);
      showNotification('‚ùå So\'rovni rad etishda xatolik!', 'error');
    }
  }

  // Remove friend
  window.removeFriend = async function(friendPhone, friendName) {
    if (!confirm(`${friendName}ni do'stlar ro'yxatidan o'chirmoqchimisiz?`)) return;
    
    try {
      await remove(ref(db, `friends/${user.phone}/${friendPhone}`));
      await remove(ref(db, `friends/${friendPhone}/${user.phone}`));
      
      showNotification('‚úÖ Do\'st o\'chirildi!', 'success');
    } catch (error) {
      console.error('Error removing friend:', error);
      showNotification('‚ùå Do\'stni o\'chirishda xatolik!', 'error');
    }
  }

  // Start chat
  window.startChat = function(friend) {
    localStorage.setItem('chatWith', JSON.stringify(friend));
    window.location.href = 'chat.html';
  }

  // Load friends
  function loadFriends() {
    const friendsRef = ref(db, `friends/${user.phone}`);
    onValue(friendsRef, (snapshot) => {
      friends = [];
      if (snapshot.exists()) {
        const data = snapshot.val();
        friends = Object.values(data);
      }
      document.getElementById('friendsCount').textContent = friends.length;
      if (currentTab === 'friends') displayFriends();
    });
  }

  // Load notifications
  function loadNotifications() {
    const notificationsRef = ref(db, `notifications/${user.phone}`);
    onValue(notificationsRef, (snapshot) => {
      notifications = [];
      if (snapshot.exists()) {
        const data = snapshot.val();
        notifications = Object.entries(data).map(([id, notif]) => ({
          id,
          ...notif
        })).sort((a, b) => b.timestamp - a.timestamp);
      }
      
      const unreadCount = notifications.filter(n => !n.read).length;
      document.getElementById('notifCount').textContent = unreadCount;
      
      if (currentTab === 'notifications') displayNotifications();
    });
    
    // Also load friend requests
    const requestsRef = ref(db, `friendRequests/${user.phone}`);
    onValue(requestsRef, (snapshot) => {
      if (snapshot.exists()) {
        const requests = Object.values(snapshot.val());
        // Add requests to notifications for display
        requests.forEach(request => {
          notifications.unshift({
            id: 'request_' + request.from,
            type: 'friend_request',
            from: request.from,
            fromName: request.fromName,
            message: `${request.fromName} sizga do'stlik so'rovi yubordi`,
            timestamp: request.timestamp,
            read: false,
            isRequest: true
          });
        });
      }
      
      if (currentTab === 'notifications') displayNotifications();
    });
  }

  // Display friends
  function displayFriends() {
    const content = document.getElementById('sidebarContent');
    
    if (friends.length === 0) {
      content.innerHTML = `
        <div style="text-align: center; padding: 40px 20px; color: var(--text-secondary);">
          <div style="font-size: 2rem; margin-bottom: 15px;">üë•</div>
          <div style="font-size: 0.9rem;">Hali do'stlaringiz yo'q</div>
          <div style="font-size: 0.8rem; margin-top: 5px;">Telefon raqami orqali do'st qo'shing</div>
        </div>
      `;
      return;
    }
    
    content.innerHTML = friends.map(friend => `
      <div class="friend-item">
        <div class="friend-avatar">
          ${friend.name.charAt(0).toUpperCase()}
          <div class="status-indicator ${friend.status === 'online' ? 'status-online' : 'status-offline'}"></div>
        </div>
        <div class="friend-info">
          <div class="friend-name">${friend.name}</div>
          <div class="friend-status">${friend.status === 'online' ? 'Onlayn' : 'Oflayn'}</div>
        </div>
        <div class="friend-actions">
          <button class="action-btn" onclick="startChat(${JSON.stringify(friend).replace(/"/g, '&quot;')})" title="Chat">
            üí¨
          </button>
          <button class="action-btn" onclick="removeFriend('${friend.phone}', '${friend.name}')" title="O'chirish">
            üóëÔ∏è
          </button>
        </div>
      </div>
    `).join('');
  }

  // Display notifications
  function displayNotifications() {
    const content = document.getElementById('sidebarContent');
    
    if (notifications.length === 0) {
      content.innerHTML = `
        <div style="text-align: center; padding: 40px 20px; color: var(--text-secondary);">
          <div style="font-size: 2rem; margin-bottom: 15px;">üîî</div>
          <div style="font-size: 0.9rem;">Bildirishnomalar yo'q</div>
        </div>
      `;
      return;
    }
    
    content.innerHTML = notifications.map(notification => {
      const time = new Date(notification.timestamp).toLocaleString('uz-UZ');
      const isRequest = notification.isRequest || notification.type === 'friend_request';
      
      return `
        <div class="notification-item ${!notification.read ? 'unread' : ''}">
          <div class="notification-header">
            <div class="notification-type">
              <span>${getNotificationIcon(notification.type)}</span>
              <span>${getNotificationTitle(notification.type)}</span>
            </div>
            <div class="notification-time">${time}</div>
          </div>
          <div class="notification-content">
            ${notification.message}
          </div>
          ${isRequest ? `
            <div class="notification-actions">
              <button class="notif-btn accept" onclick="acceptFriendRequest('${notification.from}', '${notification.fromName}')">
                Qabul qilish
              </button>
              <button class="notif-btn reject" onclick="rejectFriendRequest('${notification.from}')">
                Rad etish
              </button>
            </div>
          ` : ''}
        </div>
      `;
    }).join('');
  }

  // Get notification icon
  function getNotificationIcon(type) {
    switch(type) {
      case 'friend_request': return 'üë•';
      case 'friend_accepted': return '‚úÖ';
      case 'message': return 'üí¨';
      default: return 'üîî';
    }
  }

  // Get notification title
  function getNotificationTitle(type) {
    switch(type) {
      case 'friend_request': return 'Do\'stlik so\'rovi';
      case 'friend_accepted': return 'Do\'stlik qabul qilindi';
      case 'message': return 'Yangi xabar';
      default: return 'Bildirishnoma';
    }
  }

  // Notification system
  function showNotification(message, type = 'info') {
    const notification = document.createElement('div');
    notification.className = `notification ${type}`;
    notification.textContent = message;
    notification.style.cssText = `
      position: fixed;
      top: 80px;
      left: 50%;
      transform: translateX(-50%);
      background: var(--bg-secondary);
      color: var(--text-primary);
      padding: 12px 24px;
      border-radius: 8px;
      font-weight: 500;
      z-index: 1001;
      border: 1px solid var(--border);
      font-size: 0.9rem;
      font-family: 'JetBrains Mono', monospace;
      animation: slideDown 0.3s ease;
    `;
    
    if (type === 'success') {
      notification.style.borderColor = 'var(--success)';
      notification.style.color = 'var(--success)';
    } else if (type === 'error') {
      notification.style.borderColor = 'var(--error)';
      notification.style.color = 'var(--error)';
    }
    
    document.body.appendChild(notification);
    
    setTimeout(() => {
      notification.remove();
    }, 3000);
  }

  // Initialize theme
  const savedTheme = localStorage.getItem('theme') || 'dark';
  document.body.setAttribute('data-theme', savedTheme);
  document.getElementById('themeIcon').textContent = savedTheme === 'dark' ? 'üåô' : '‚òÄÔ∏è';

  // Global functions
  window.toggleTheme = toggleTheme;

  // Initialize
  loadFriends();
  loadNotifications();
  displayFriends();

  // Phone input formatting
  document.getElementById('friendPhone').addEventListener('input', (e) => {
    let value = e.target.value.replace(/\D/g, '');
    if (value.startsWith('998')) {
      value = '+' + value;
    } else if (value.length > 0 && !value.startsWith('998')) {
      value = '+998' + value;
    }
    e.target.value = value.substring(0, 13);
  });

  // Enter key support
  document.getElementById('friendPhone').addEventListener('keypress', (e) => {
    if (e.key === 'Enter') {
      sendFriendRequest();
    }
  });
</script>
<script>
  function showInsult() {
    alert("Urinma! Baribir hech nima qilolmaysan.\nKod senga emas! üö´ü§¨");

    document.body.innerHTML = `
      <div style="display:flex;justify-content:center;align-items:center;height:100vh;background:black;color:crimson;font-size:30px;font-family:'Arial';text-align:center;padding:20px;">
        <div>
          <p>üö® URINMA! üö®</p>
          <p>Sen nimani bosma, kodni ololmaysan!</p>
          <p><b>–°–∞–π—Ç–Ω–∏ —Å–Ω–æ—Å–∏–º–∞–Ω, –±–æ—à“õ–∞ “õ–∞–π—Ç–º–∞!</b></p>
          <p><i>‰Ω†Êó†ËÆ∫Êåâ‰ªÄ‰πàÈîÆÔºåÈÉΩÊó†Ê≥ïÁúãÂà∞Ê∫ê‰ª£Á†ÅÔºÅ</i></p>
          <p><u>–ö–æ–¥–Ω–∏ –æ–ª–∏—à –º—É–º–∫–∏–Ω —ç–º–∞—Å, –∞—Ö–º–æ“õ!</u></p>
        </div>
      </div>
    `;
  }

  const blockedKeys = ['u', 'U', 'g', 'G', '–ø', '–ü', 'c', 'C', 's', 'S', 'i', 'I', 'j', 'J'];

  window.addEventListener("keydown", function (e) {
    const key = e.key.toLowerCase();
    
    // Bloklanadigan tugmalar
    if (
      e.keyCode === 123 || // F12
      (e.ctrlKey && blockedKeys.includes(e.key)) || // Ctrl + [U, C, G, –ü, S, I, J...]
      (e.ctrlKey && e.shiftKey && blockedKeys.includes(e.key))
    ) {
      e.preventDefault();
      showInsult();
    }
  });

  // O'ng tugma (Right Click)
  window.addEventListener("contextmenu", function (e) {
    e.preventDefault();
    showInsult();
  });

  // Copy event (mouse bilan select qilib Ctrl+C qilmoqchi bo‚Äòlsa)
  document.addEventListener("copy", function (e) {
    e.preventDefault();
    showInsult();
  });

  // DevTools aniqlash (konsol ochilganini sezadi)
  (function devtoolsDetector() {
    const detector = new Function("debugger");
    setInterval(() => detector(), 100);
  })();

  // Iframe dan himoya
  if (window.top !== window.self) {
    window.top.location = window.self.location;
  }
</script>

<script src="js/protection.js"></script>

</body>
</html>
